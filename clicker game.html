<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clicker Game</title>
<style>
body {
font-family: sans-serif;
background-color: #f1f59; /* A light slate color */
display: flex;
justify-content: center;
align-items: center;
min-height: 100vh;
margin: 0;
padding: 20px;
}

.circle-button {
width: 100px; /* Adjust size */
height: 100px; /* Adjust size */
background-color: red; /* Red color */
border: none; /* Remove border */
border-radius: 50%; /* Make it circular */
color: white; /* Text color */
cursor: pointer; /* Pointer on hover */
display: flex;
justify-content: center;
align-items: center;
text-align: center;
font-size: 25px;
text-shadow : 0 0 9px rgba(9, 9, 9, 9.5);
padding: 5px;
transition: all 0.3s ease;
font-family: lemon-milk;
    transition: transform 0.1s ease;
    }

    button:active {
      transform: scale(0.95); /* Creates a "pressed" effect */
      background-color: red; /* Slightly darker shade */
}

.circle-button.disabled {
background-color: gray !important;
cursor: not-allowed;
opacity: 0.5;
}
.upgrade-button {
    width:100%;
    height: 50px;
    background-color: #4CAF50;
    border: none;
    border-radius: 0%;
    color: white;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 1px;
    transition: all 0.3s ease;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    border-radius: 0px;
}
    .upgrade-button.disabled {
     background-color: #555555 !important;
     cursor: not-allowed;
     opacity: 0.6;
}    

/* The animated hand circle */
#hand {
    position: absolute;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255, 200, 0, 0.6);
    display: none; /* Hidden by default */
    align-items: center;
    justify-content: center;
    font-size: 20px;
    pointer-events: none; /* Don't block clicks */
    z-index: 0;
    transform-origin: center;
    transition: transform 0.05s linear;
}

    /* Style for the 'Click Me' button */
#click-button {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
font-family: lemon-milk;
font-size: 20px;
}

/* Style for the 'Spend Clicks' button */
#spend-button {
background-color: lightblue; /* Blue color for the new button */
top: 200px; /* Same bottom position */
right: 50px; /* Shifted to the left of the original button */
font-family: lemon-milk;
font-size: 25px;
}

/* Style for the 'Spend 100 Clicks' button */
#spend-button-100 {
background-color: purple;
display: none;
font-family: lemon-milk;
font-size: 25px;
}

/* Style for the 'Spend 1000 Clicks' button */
#spend-button-1000 {
background-color: green;
display: none;
font-family: lemon-milk;
font-size: 25px;
}

/* Style for the new 10000 clicks button */
#spend-button-10000 {
background-color: orange; /* Example color */
display: none; /* Initially hidden */
font-family: lemon-milk;
font-size: 25px;
}

/* Style for the auto-clicker unlock button */
#unlock-auto-clicker-button {
background-color: gold;
display: none; /* Initially hidden */
font-family: lemon-milk;
font-size: 25px;
}

.circle-button:hover:not(.disabled) {
filter: brightness(0.9); /* Darken slightly on hover for both */
}

#counter-container {
position: fixed;
top: 0;
left: 0;
width: 100%;
background-color: #333;
color: white;
padding: 1px;
text-align: center;
font-size: 24px;
z-index: 1000;
}

#counter {
margin: 0;
font-weight: bold;
}
.ui-box {
background-color: white;
side-padding: 0px;

border-radius: 12px;
box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
position : absolute;
right : 0;
width: 19%;
max-width: 448px;
box-sizing: border-box;
text-align: center;
size-adjust false;
}
    
</style>
</head>
<body>
<div id="counter-container">
Clicks: <span id="counter">0</span> | Clicks per click: <span id="bonus">1</span>
{% if username %}
<p style="font-size: 16px; margin: 5px 0;">Welcome, {{ username }}! <a href="/logout" style="color: #ffcccc;">Logout</a></p>
{% endif %}
    <a href="{{ url_for('website') }}"style="color: #ffcccc;">Back to Website</a>
</div>

<div id="message-display" style="position: absolute; top: 40%; left: 50%; transform: translateX(-50%); font-size: 18px; color: red; font-weight: bold; min-height: 20px; text-align: center; background-color: lightslategray(255, 255, 255, 0.9); padding: 10px 20px; border-radius: 8px;"></div>

<button class="circle-button" id="click-button">
Click
</button>
<div id="hand">ðŸ‘†</div>
<div class='ui-box'>
<button class="upgrade-button" id="spend-button">
Spend 10 Clicks
</button>

<button class="upgrade-button" id="spend-button-100">
Spend 100 Clicks
</button>

<button class="upgrade-button" id="spend-button-1000">
Spend 1000 Clicks
</button>

<button class="upgrade-button" id="spend-button-10000">
Spend 10000 Clicks
</button>

<button class="upgrade-button" id="unlock-auto-clicker-button" style="background-color: gold;">
Unlock Auto-Clicker (15000 clicks)
</button>
</div>
<script>
// Get button elements
const clickButton = document.getElementById('click-button');
const spendButton = document.getElementById('spend-button');
const spendButton100 = document.getElementById('spend-button-100');
const spendButton1000 = document.getElementById('spend-button-1000');
const spendButton10000 = document.getElementById('spend-button-10000'); // New button element
const unlockAutoClickerButton = document.getElementById('unlock-auto-clicker-button');

// Get the counter element
const counterElement = document.getElementById('counter');
const bonusElement = document.getElementById('bonus');

// Initialize the counter value from server data
let counterValue = {{ clicks if clicks is defined else 0 }};
let bonusValue = {{ click_bonus if click_bonus is defined else 1 }};
let hasUnlocked100 = {{ has_unlocked_100|tojson }};
let hasUnlocked1000 = {{ has_unlocked_1000|tojson }};
let hasUnlocked10000 = {{ has_unlocked_10000|tojson }}; // New state variable
let hasAutoClicker = {{ has_auto_clicker|tojson }}; // Auto-clicker state

const SPEND_AMOUNT = 10; // Define how many clicks are spent
const SPEND_AMOUNT_100 = 100; // Define how many clicks for the 100 upgrade
const SPEND_AMOUNT_1000 = 1000; // Define how many clicks for the 1000 upgrade
const SPEND_AMOUNT_10000 = 10000; // Define clicks for the new upgrade
const SPEND_AMOUNT_AUTO_CLICKER = 15000; // Cost to unlock auto-clicker

// Update the display with saved clicks
counterElement.textContent = counterValue;
bonusElement.textContent = bonusValue;

// Update button states based on clicks
function updateButtonStates() {
    // Update spend 10 button
    if (counterValue >= SPEND_AMOUNT) {
        spendButton.classList.remove('disabled');
    } else {
        spendButton.classList.add('disabled');
    }

    // Update spend 100 button
    if (counterValue >= SPEND_AMOUNT_100) {
        spendButton100.classList.remove('disabled');
    } else {
        spendButton100.classList.add('disabled');
    }

    // Update spend 1000 button
    if (counterValue >= SPEND_AMOUNT_1000) {
        spendButton1000.classList.remove('disabled');
    } else {
        spendButton1000.classList.add('disabled');
    }

    // Update spend 10000 button
    if (counterValue >= SPEND_AMOUNT_10000) {
        spendButton10000.classList.remove('disabled');
    } else {
        spendButton10000.classList.add('disabled');
    }

    // Show/hide the 100 clicks button based on unlock status
    if (hasUnlocked100) {
        spendButton100.style.display = 'flex';
    } else {
        spendButton100.style.display = 'none';
    }

    // Show/hide the 1000 clicks button based on unlock status
    if (hasUnlocked1000) {
        spendButton1000.style.display = 'flex';
    } else {
        spendButton1000.style.display = 'none';
    }

    // Show/hide the 10000 clicks button based on unlock status
    if (hasUnlocked10000) {
        spendButton10000.style.display = 'flex';
    } else {
        spendButton10000.style.display = 'none';
    }

    // Show/hide the auto-clicker unlock button
    if (hasUnlocked10000 && !hasAutoClicker) {
        unlockAutoClickerButton.style.display = 'flex';
        if (counterValue >= SPEND_AMOUNT_AUTO_CLICKER) {
            unlockAutoClickerButton.classList.remove('disabled');
        } else {
            unlockAutoClickerButton.classList.add('disabled');
        }
    } else {
        unlockAutoClickerButton.style.display = 'none';
    }
}

// Initial button state update
updateButtonStates();

/**
* Generic function to send a click action to the server
* @param {string} endpoint - The server endpoint (e.g., '/save_click' or '/spend_clicks')
* @param {number} localDelta - The amount to change the counter locally on error
*/
async function sendClickAction(endpoint, localDelta) {
try {
const response = await fetch(endpoint, {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
// You might want to send the spend amount, but we'll assume the server knows for simplicity
body: JSON.stringify({ amount: Math.abs(localDelta) })
});

if (response.ok) {
const data = await response.json();
counterValue = data.clicks; // Use the authoritative count from the server
counterElement.textContent = counterValue;
if (data.click_bonus !== undefined) {
bonusValue = data.click_bonus;
bonusElement.textContent = bonusValue;
}
if (data.has_unlocked_100 !== undefined) {
hasUnlocked100 = data.has_unlocked_100;
}
if (data.has_unlocked_1000 !== undefined) {
hasUnlocked1000 = data.has_unlocked_1000;
}
if (data.has_unlocked_10000 !== undefined) {
                hasUnlocked10000 = data.has_unlocked_10000;
            }
            updateButtonStates();
} else {
console.error(`Failed to perform action at ${endpoint}`);
// Fallback: try to update locally if server fails
counterValue += localDelta;
counterElement.textContent = counterValue;
updateButtonStates();
}
} catch (error) {
console.error(`Error with ${endpoint}:`, error);
// Fallback: update locally
counterValue += localDelta;
counterElement.textContent = counterValue;
}
}

// --- Event Listeners ---

// 1. Add click listener (Original functionality)
clickButton.addEventListener('click', () => {
sendClickAction('/save_click', 1); // +1 click locally on error
});

// Helper function to show messages
function showMessage(text, duration = 3000) {
const messageDisplay = document.getElementById('message-display');
messageDisplay.textContent = text;
setTimeout(() => {
messageDisplay.textContent = '';
}, duration);
}

// 2. Spend 10 clicks listener
spendButton.addEventListener('click', () => {
if (counterValue >= SPEND_AMOUNT) {
sendClickAction('/spend_clicks', -SPEND_AMOUNT); // -10 clicks locally on error
} else {
showMessage(`You need ${SPEND_AMOUNT} clicks to use this!`);
}
});

// 3. Spend 100 clicks listener
spendButton100.addEventListener('click', () => {
if (counterValue >= SPEND_AMOUNT_100) {
sendClickAction('/spend_clicks_100', -SPEND_AMOUNT_100); // -100 clicks locally on error
} else {
showMessage(`You need ${SPEND_AMOUNT_100} clicks to use this!`);
}
});

// 4. Spend 1000 clicks listener
spendButton1000.addEventListener('click', () => {
if (counterValue >= SPEND_AMOUNT_1000) {
sendClickAction('/spend_clicks_1000', -SPEND_AMOUNT_1000); // -1000 clicks locally on error
} else {
showMessage(`You need ${SPEND_AMOUNT_1000} clicks to use this!`);
}
});

// 5. Spend 10000 clicks listener (New functionality)
spendButton10000.addEventListener('click', () => {
if (counterValue >= SPEND_AMOUNT_10000) {
sendClickAction('/spend_clicks_10000', -SPEND_AMOUNT_10000); // -10000 clicks locally on error
} else {
showMessage(`You need ${SPEND_AMOUNT_10000} clicks to use this!`);
}
});

// 6. Unlock auto-clicker listener
unlockAutoClickerButton.addEventListener('click', async () => {
    if (counterValue < SPEND_AMOUNT_AUTO_CLICKER) {
        showMessage(`You need ${SPEND_AMOUNT_AUTO_CLICKER} clicks to unlock the auto-clicker!`);
        return;
    }
    
    try {
        const response = await fetch('/unlock_auto_clicker', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });

        if (response.ok) {
            const data = await response.json();
            if (data.clicks !== undefined) {
                counterValue = data.clicks;
                counterElement.textContent = counterValue;
            }
            if (data.has_auto_clicker !== undefined) {
                hasAutoClicker = data.has_auto_clicker;
                if (hasAutoClicker && !autoClickInterval) {
                    startAutoClicker();
                }
                updateButtonStates();
                showMessage('Auto-clicker unlocked!');
            }
        } else {
            const errorData = await response.json();
            showMessage(errorData.error || 'Failed to unlock auto-clicker');
        }
    } catch (error) {
        console.error('Error unlocking auto-clicker:', error);
        showMessage('Error unlocking auto-clicker');
    }
});

// --- Auto-clicker Hand Animation ---
const hand = document.getElementById('hand');
let autoClickInterval = null;
let animationFrameId = null;

function startAutoClicker() {
    if (!hasAutoClicker || autoClickInterval) return;
    
    // Show the hand
    hand.style.display = 'flex';
    
    // Get button position
    const rect = clickButton.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2 + window.scrollX;
    const centerY = rect.top + rect.height / 2 + window.scrollY;
    
    let angle = 0;
    const radius = 80; // Distance from button center
    const speed = 0.05; // Radians per frame
    
    // Animate the hand in a circle
    function animate() {
        angle += speed;
        const x = centerX + radius * Math.cos(angle) - hand.offsetWidth / 2;
        const y = centerY + radius * Math.sin(angle) - hand.offsetHeight / 2;
        hand.style.left = `${x}px`;
        hand.style.top = `${y}px`;
        
        // Make the hand point at the center
        const rotationRad = angle - Math.PI / 2;
        const rotationDeg = rotationRad * (180 / Math.PI);
        hand.style.transform = `rotate(${rotationDeg}deg)`;
        
        animationFrameId = requestAnimationFrame(animate);
    }
    animate();
    
    // Auto-click every second
    autoClickInterval = setInterval(() => {
        clickButton.click();
    }, 1000);
}

// Start auto-clicker if already unlocked
if (hasAutoClicker) {
    startAutoClicker();
}

</script>
</body>
</html>